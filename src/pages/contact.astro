---
import Layout from '../layouts/Layout.astro';
import { client, queries, urlFor } from '../lib/sanity';

// Fetch contact page data from Sanity
const contactPage = await client.fetch(queries.contactPage);
const siteSettings = await client.fetch(queries.siteSettings);

// Helper function to get image URL safely
function getImageUrl(image: any, width: number, height: number): string {
	if (!image?.asset?._ref) {
		return 'https://images.unsplash.com/photo-1566073771259-6a8506099945?w=' + width + '&h=' + height + '&fit=crop&auto=format&q=80&fm=webp';
	}
	return urlFor(image).width(width).height(height).format('webp').quality(85).url();
}

// Extract contact page content
const pageTitle = contactPage?.pageTitle || 'Contact Us - Paradise Hotel';
const heroTitle = contactPage?.heroTitle || 'Contact Us';
const heroSubtitle = contactPage?.heroSubtitle || 'Get in Touch';
const heroImage = contactPage?.heroImage;
const contactInfo = contactPage?.contactInfo || siteSettings?.contactInfo;
const address = contactPage?.address || contactInfo?.address || siteSettings?.contactInfo?.address || '123 Luxury Lane, City, State 12345';
const phone = contactPage?.phone || contactInfo?.phone || siteSettings?.contactInfo?.phone || '+1 (555) 123-4567';
const email = contactPage?.email || contactInfo?.email || siteSettings?.contactInfo?.email || 'info@luxuryhotel.com';
---

<Layout 
	title={pageTitle}
	description="Contact Paradise Hotel for reservations, inquiries, or assistance. We're here to help make your stay exceptional."
	type="website"
>
	<main id="main">
		<!-- Hero Section -->
		<section class="page-hero">
			<div class="hero-content">
				<div class="wrapper">
					<div class="hero-text">
						<span class="hero-subtitle" data-sanity-edit-field="contact-page#heroSubtitle">{heroSubtitle}</span>
						<h1 data-sanity-edit-field="contact-page#heroTitle">{heroTitle}</h1>
						<p data-sanity-edit-field="contact-page#heroDescription">We're here to help make your stay exceptional. Reach out to us for reservations, inquiries, or any assistance you may need.</p>
					</div>
				</div>
			</div>
			{heroImage && (
				<div class="hero-image">
					<img 
						src={getImageUrl(heroImage, 1920, 1080)} 
						alt={heroTitle}
						loading="eager"
					/>
				</div>
			)}
		</section>

		<!-- Contact Information -->
		<section class="contact-info">
			<div class="wrapper">
				<div class="contact-grid">
					<div class="contact-card">
						<div class="contact-icon">üìç</div>
						<h3 data-sanity-edit-field="contact-page#addressTitle">Address</h3>
						<div class="contact-details">
							{Array.isArray(address) ? (
								address.map((line: string) => (
									<p data-sanity-edit-field="contact-page#address">{line}</p>
								))
							) : (
								<p data-sanity-edit-field="contact-page#address">{address}</p>
							)}
						</div>
					</div>
					
					<div class="contact-card">
						<div class="contact-icon">üìû</div>
						<h3 data-sanity-edit-field="contact-page#phoneTitle">Phone</h3>
						<div class="contact-details">
							<p><a href={`tel:${phone}`} data-sanity-edit-field="contact-page#phone">{phone}</a></p>
							<p class="contact-note" data-sanity-edit-field="contact-page#phoneNote">Available 24/7 for reservations</p>
						</div>
					</div>
					
					<div class="contact-card">
						<div class="contact-icon">‚úâÔ∏è</div>
						<h3 data-sanity-edit-field="contact-page#emailTitle">Email</h3>
						<div class="contact-details">
							<p><a href={`mailto:${email}`} data-sanity-edit-field="contact-page#email">{email}</a></p>
							<p class="contact-note" data-sanity-edit-field="contact-page#emailNote">We'll respond within 24 hours</p>
						</div>
					</div>
				</div>
			</div>
		</section>

		<!-- Contact Form -->
		<section class="contact-form-section">
			<div class="wrapper">
				<div class="form-container">
					<h2 data-sanity-edit-field="contact-page#formTitle">Send us a Message</h2>
					<p data-sanity-edit-field="contact-page#formDescription">Have a question or special request? We'd love to hear from you.</p>
					
					<form class="contact-form" action="#" method="POST">
						<div class="form-row">
							<div class="form-group">
								<label for="firstName">First Name</label>
								<input type="text" id="firstName" name="firstName" required />
							</div>
							<div class="form-group">
								<label for="lastName">Last Name</label>
								<input type="text" id="lastName" name="lastName" required />
							</div>
						</div>
						
						<div class="form-row">
							<div class="form-group">
								<label for="email">Email Address</label>
								<input type="email" id="email" name="email" required />
							</div>
							<div class="form-group">
								<label for="phone">Phone Number</label>
								<input type="tel" id="phone" name="phone" />
							</div>
						</div>
						
						<div class="form-group">
							<label for="subject">Subject</label>
							<select id="subject" name="subject" required>
								<option value="">Select a subject</option>
								<option value="reservation">Reservation Inquiry</option>
								<option value="general">General Question</option>
								<option value="event">Event Planning</option>
								<option value="feedback">Feedback</option>
								<option value="other">Other</option>
							</select>
						</div>
						
						<div class="form-group">
							<label for="message">Message</label>
							<textarea id="message" name="message" rows="6" required placeholder="Tell us how we can help you..."></textarea>
						</div>
						
						<button type="submit" class="btn btn-primary">Send Message</button>
					</form>
				</div>
			</div>
		</section>

		<!-- Additional Information -->
		<section class="contact-additional">
			<div class="wrapper">
				<div class="additional-grid">
					<div class="additional-card">
						<h3 data-sanity-edit-field="contact-page#reservationsTitle">Reservations</h3>
						<p data-sanity-edit-field="contact-page#reservationsDescription">For immediate assistance with reservations, call us directly or use our online booking system.</p>
						<a href="/rooms" class="btn btn-secondary" data-sanity-edit-field="contact-page#reservationsButton">View Rooms</a>
					</div>
					
					<div class="additional-card">
						<h3 data-sanity-edit-field="contact-page#conciergeTitle">Concierge Services</h3>
						<p data-sanity-edit-field="contact-page#conciergeDescription">Our concierge team is available to help with restaurant reservations, transportation, and local recommendations.</p>
						<a href="/amenities" class="btn btn-secondary" data-sanity-edit-field="contact-page#conciergeButton">Learn More</a>
					</div>
					
					<div class="additional-card">
						<h3 data-sanity-edit-field="contact-page#eventsTitle">Group Events</h3>
						<p data-sanity-edit-field="contact-page#eventsDescription">Planning a special event or group stay? Our events team can help create the perfect experience.</p>
						<a href="/contact" class="btn btn-secondary" data-sanity-edit-field="contact-page#eventsButton">Contact Events</a>
					</div>
				</div>
			</div>
		</section>
	</main>
</Layout>
