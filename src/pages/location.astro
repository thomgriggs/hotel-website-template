---
import Layout from '../layouts/Layout.astro';
import { client, queries, urlFor } from '../lib/sanity';

// Fetch location page data from Sanity
const locationPage = await client.fetch(queries.locationPage);

// Helper function to get image URL safely
function getImageUrl(image: any, width: number, height: number): string {
	if (!image?.asset?._ref) {
		return 'https://images.unsplash.com/photo-1566073771259-6a8506099945?w=' + width + '&h=' + height + '&fit=crop&auto=format&q=80&fm=webp';
	}
	return urlFor(image).width(width).height(height).format('webp').quality(85).url();
}

// Extract location page content
const pageTitle = locationPage?.pageTitle || 'Location - Paradise Hotel';
const heroTitle = locationPage?.heroTitle || 'Our Location';
const heroSubtitle = locationPage?.heroSubtitle || 'Paradise Awaits';
const heroImage = locationPage?.heroImage;
const address = locationPage?.address || '123 Paradise Drive, Paradise City, Paradise State 12345';
const mapSettings = locationPage?.mapSettings || {
	latitude: 25.7617,
	longitude: -80.1918,
	zoom: 15,
	markerText: 'Paradise Hotel'
};
---

<Layout 
	title={pageTitle}
	description="Discover Paradise Hotel's prime location with easy access to beaches, attractions, and cultural sites. Experience the best of both luxury and adventure."
	type="website"
>
	<main id="main">
		<!-- Hero Section -->
		<section class="page-hero">
			<div class="hero-content">
				<div class="wrapper">
					<div class="hero-text">
						<span class="hero-subtitle" data-sanity-edit-field="location-page#heroSubtitle">{heroSubtitle}</span>
						<h1 data-sanity-edit-field="location-page#heroTitle">{heroTitle}</h1>
						<p data-sanity-edit-field="location-page#heroDescription">Located in the heart of paradise with easy access to beaches, attractions, and cultural sites. Experience the best of both luxury and adventure.</p>
					</div>
				</div>
			</div>
			{heroImage && (
				<div class="hero-image">
					<img 
						src={getImageUrl(heroImage, 1920, 1080)} 
						alt={heroTitle}
						loading="eager"
					/>
				</div>
			)}
		</section>

		<!-- Address & Map -->
		<section class="location-main">
			<div class="wrapper">
				<div class="location-grid">
					<div class="address-card">
						<h2 data-sanity-edit-field="location-page#addressTitle">Our Address</h2>
						<div class="address-details">
							<p data-sanity-edit-field="location-page#address">{address}</p>
							<div class="address-actions">
								<a href={`https://maps.google.com/maps?q=${encodeURIComponent(address)}`} target="_blank" rel="noopener noreferrer" class="btn btn-primary" data-sanity-edit-field="location-page#directionsButton">
									<span class="material-symbols-outlined">directions</span>
									Get Directions
								</a>
								<a href="tel:+1-555-PARADISE" class="btn btn-secondary" data-sanity-edit-field="location-page#callButton">
									<span class="material-symbols-outlined">phone</span>
									Call Us
								</a>
							</div>
						</div>
					</div>
					
					<div class="map-container">
						<div 
							id="hotel-map"
							class="map"
							data-lat={mapSettings.latitude}
							data-lng={mapSettings.longitude}
							data-zoom={mapSettings.zoom}
							data-marker-text={mapSettings.markerText}
						></div>
					</div>
				</div>
			</div>
		</section>

		<!-- Transportation -->
		<section class="transportation">
			<div class="wrapper">
				<h2 data-sanity-edit-field="location-page#transportationTitle">Getting Here</h2>
				<div class="transport-grid">
					<div class="transport-card">
						<div class="transport-icon">‚úàÔ∏è</div>
						<h3>By Air</h3>
						<p><strong>Paradise International Airport (PIA)</strong></p>
						<p>15 minutes by car or taxi</p>
						<p>Airport shuttle service available</p>
					</div>
					
					<div class="transport-card">
						<div class="transport-icon">üöó</div>
						<h3>By Car</h3>
						<p><strong>From Downtown Paradise</strong></p>
						<p>Take Paradise Drive south for 5 miles</p>
						<p>Free valet parking available</p>
					</div>
					
					<div class="transport-card">
						<div class="transport-icon">üöå</div>
						<h3>Public Transit</h3>
						<p><strong>Paradise Metro Bus</strong></p>
						<p>Route 42 stops directly in front</p>
						<p>Every 15 minutes during peak hours</p>
					</div>
					
					<div class="transport-card">
						<div class="transport-icon">üö¢</div>
						<h3>By Water</h3>
						<p><strong>Paradise Marina</strong></p>
						<p>Private dock available for guests</p>
						<p>Water taxi service to downtown</p>
					</div>
				</div>
			</div>
		</section>

		<!-- Local Attractions -->
		<section class="attractions">
			<div class="wrapper">
				<h2 data-sanity-edit-field="location-page#attractionsTitle">Nearby Attractions</h2>
				<div class="attractions-grid">
					<div class="attraction-card">
						<div class="attraction-image">
							<img src="https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=400&h=300&fit=crop&auto=format&q=80&fm=webp" alt="Paradise Beach" loading="lazy" />
						</div>
						<div class="attraction-content">
							<h3>Paradise Beach</h3>
							<p>World-renowned white sand beach with crystal clear waters</p>
							<div class="attraction-details">
								<span class="distance">0.5 miles</span>
								<span class="time">5 min walk</span>
							</div>
						</div>
					</div>
					
					<div class="attraction-card">
						<div class="attraction-image">
							<img src="https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=300&fit=crop&auto=format&q=80&fm=webp" alt="Paradise Gardens" loading="lazy" />
						</div>
						<div class="attraction-content">
							<h3>Paradise Botanical Gardens</h3>
							<p>Stunning tropical gardens with rare plant species</p>
							<div class="attraction-details">
								<span class="distance">1.2 miles</span>
								<span class="time">15 min walk</span>
							</div>
						</div>
					</div>
					
					<div class="attraction-card">
						<div class="attraction-image">
							<img src="https://images.unsplash.com/photo-1571896349842-33c89424de2d?w=400&h=300&fit=crop&auto=format&q=80&fm=webp" alt="Paradise Museum" loading="lazy" />
						</div>
						<div class="attraction-content">
							<h3>Paradise Art Museum</h3>
							<p>Contemporary art museum featuring local and international artists</p>
							<div class="attraction-details">
								<span class="distance">2.1 miles</span>
								<span class="time">25 min walk</span>
							</div>
						</div>
					</div>
					
					<div class="attraction-card">
						<div class="attraction-image">
							<img src="https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=400&h=300&fit=crop&auto=format&q=80&fm=webp" alt="Paradise Marina" loading="lazy" />
						</div>
						<div class="attraction-content">
							<h3>Paradise Marina</h3>
							<p>Luxury marina with yacht charters and water activities</p>
							<div class="attraction-details">
								<span class="distance">0.8 miles</span>
								<span class="time">10 min walk</span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>

		<!-- Parking & Accessibility -->
		<section class="parking-accessibility">
			<div class="wrapper">
				<div class="info-grid">
					<div class="info-card">
						<h3>Parking</h3>
						<ul>
							<li>Complimentary valet parking</li>
							<li>Self-parking garage available</li>
							<li>Electric vehicle charging stations</li>
							<li>Oversized vehicle parking</li>
						</ul>
					</div>
					
					<div class="info-card">
						<h3>Accessibility</h3>
						<ul>
							<li>Wheelchair accessible entrances</li>
							<li>Elevator access to all floors</li>
							<li>Accessible parking spaces</li>
							<li>Assistance available 24/7</li>
						</ul>
					</div>
				</div>
			</div>
		</section>
	</main>
</Layout>

<script>
	// Initialize map when page loads
	document.addEventListener('DOMContentLoaded', function() {
		const mapElement = document.getElementById('hotel-map');
		
		if (mapElement) {
			const lat = parseFloat(mapElement.dataset.lat);
			const lng = parseFloat(mapElement.dataset.lng);
			const zoom = parseInt(mapElement.dataset.zoom);
			const markerText = mapElement.dataset.markerText;
			
			if (lat && lng) {
				// Initialize Leaflet map
				const map = L.map('hotel-map').setView([lat, lng], zoom);
				
				L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
					attribution: '¬© OpenStreetMap contributors'
				}).addTo(map);
				
				if (markerText) {
					L.marker([lat, lng]).addTo(map)
						.bindPopup(markerText);
				}
			}
		}
	});
</script>
