---
import { client, queries, urlFor } from '../lib/sanity';

// Helper function to build URL from navigation item
function buildNavigationUrl(item: any): string {
	if (item.linkType === 'external') {
		return item.externalUrl;
	}
	
	switch (item.pageType) {
		case 'main':
			return item.mainPage;
		case 'room':
			return `/rooms/${item.roomSlug}`;
		case 'restaurant':
			return `/dining/${item.restaurantSlug}`;
		case 'amenity':
			return `/amenities/${item.amenitySlug}`;
		default:
			return item.mainPage || '/';
	}
}

// Fetch site settings from Sanity
const siteSettings = await client.fetch(queries.siteSettings);

// Extract data from siteSettings - only use CMS data
const logoWhite = siteSettings?.logoWhite;
const contactInfo = siteSettings?.contactInfo;
const footerMenu = siteSettings?.footerMenu || [];
const socialLinks = siteSettings?.socialLinks || [];
const legalLinks = siteSettings?.legalLinks || [];
const partnerLogos = siteSettings?.partnerLogos || [];

// Helper function to get image URL safely
function getImageUrl(image: any, width: number, height: number): string {
	if (!image?.asset?._ref) {
		return '/logo-white-placeholder.png';
	}
	return urlFor(image).width(width).height(height).url();
}

// Helper function to get social icon
function getSocialIcon(platform: string): string {
	const icons: { [key: string]: string } = {
		facebook: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></svg>`,
		instagram: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg>`,
		twitter: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"/></svg>`,
		linkedin: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>`,
		youtube: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2.5 17a24.12 24.12 0 0 1 0-10 2 2 0 0 1 1.4-1.4l49.6-18.2a2 2 0 0 1 2.1.1l18.2 9.1a2 2 0 0 1 0 3.5l-18.2 9.1a2 2 0 0 1-2.1.1L3.9 18.4A2 2 0 0 1 2.5 17z"/></svg>`,
		tiktok: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19.321 6.5a5.5 5.5 0 0 1-5.5-5.5v-1"/><path d="M13.821 1h-3.5a5.5 5.5 0 0 0-5.5 5.5v11a5.5 5.5 0 0 0 5.5 5.5h3.5a5.5 5.5 0 0 0 5.5-5.5v-11A5.5 5.5 0 0 0 13.821 1z"/></svg>`,
		pinterest: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2C6.5 2 2 6.5 2 12c0 4.2 2.5 7.8 6 9.5-.1-.8-.2-2 .1-2.8.2-.8 1.2-5.2 1.2-5.2s-.3-.6-.3-1.5c0-1.4.8-2.4 1.8-2.4.8 0 1.2.6 1.2 1.4 0 .8-.5 2-.8 3.1-.2.9.5 1.6 1.4 1.6 1.7 0 3-.1 3-2.4 0-1-.7-1.7-1.5-1.7-1.2 0-1.9 1-1.9 2.1 0 .8.3 1.3.7 1.3.3 0 .6-.2.6-.5 0-.3-.2-.5-.4-.7-.1-.2-.3-.3-.5-.5-.2-.2-.3-.4-.3-.6 0-.5.4-.9 1-.9.5 0 .9.2 1.2.5.3.3.5.7.5 1.2 0 1.7-1 2.9-2.4 2.9-1 0-1.8-.5-2.1-1.2l-.6 2.3c-.2.8-.8 1.8-1.2 2.4 1 .3 2 .5 3 .5 5.5 0 10-4.5 10-10S17.5 2 12 2z"/></svg>`
	};
	return icons[platform] || `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>`;
}
---


<footer>
	<div class="footer-top">
		<div class="wrapper">
			<div class="footer-columns">
				<div class="footer-column">
					<a class="footer-logo" href="/" data-sanity-edit-field="siteSettings#footerLogo">
						<span class="footer-logo-text">{siteSettings?.title || "Paradise Hotel"}</span>
					</a>
					<ul class="footer-partners">
						{partnerLogos && Array.isArray(partnerLogos) && partnerLogos.map((logo: any) => (
							<li>
								<a href={logo.url || '#'} aria-label={logo.alt || 'Partner'}>
									<img height="76" width="105" src={getImageUrl(logo, 105, 76)} alt={logo.alt || 'Partner'} />
								</a>
							</li>
						))}
					</ul>
				</div>
				<div class="footer-column">
					<ul class="footer-links">
						{contactInfo?.address && (
							<li>
								<span class="address" data-sanity-edit-field="siteSettings#contactInfo.address">
									{Array.isArray(contactInfo.address) ? (
										contactInfo.address.map((line: string, index: number) => (
											<span>{line}{index < contactInfo.address.length - 1 ? <br /> : ''}</span>
										))
									) : (
										<span>{contactInfo.address}</span>
									)}
								</span>
							</li>
						)}
						{contactInfo?.phone && (
							<li>
								<span class="telephone">
									<a href={`tel:${contactInfo.phone}`} data-sanity-edit-field="siteSettings#contactInfo.phone">
										<span>Tel:</span>
										<span>{contactInfo.phone}</span>
									</a>
								</span>
							</li>
						)}
						{contactInfo?.email && (
							<li>
								<span class="email">
									<a href={`mailto:${contactInfo.email}`} data-sanity-edit-field="siteSettings#contactInfo.email">
										<span>{contactInfo.email}</span>
									</a>
								</span>
							</li>
						)}
					</ul>
				</div>
				<div class="footer-column">
					<ul class="footer-menu">
						{footerMenu && Array.isArray(footerMenu) && footerMenu.map((item: any) => {
							const url = buildNavigationUrl(item);
							const target = item.linkType === 'external' && item.openInNewTab ? '_blank' : '_self';
							const rel = item.linkType === 'external' && item.openInNewTab ? 'noopener noreferrer' : '';
							return (
								<li>
									<a href={url} target={target} rel={rel}>
										{item.label}
									</a>
								</li>
							);
						})}
					</ul>
					<ul class="social">
						{socialLinks && Array.isArray(socialLinks) && socialLinks.map((social: any) => {
							const icon = social.customIcon ? getImageUrl(social.customIcon, 24, 24) : getSocialIcon(social.platform);
							const ariaLabel = social.ariaLabel || `${social.platform} social media`;
							return (
								<li>
									<a href={social.url} aria-label={ariaLabel} target="_blank" rel="noopener noreferrer">
										{social.customIcon ? (
											<img src={icon} alt={ariaLabel} width="24" height="24" />
										) : (
											<span class="social-icon" set:html={icon}></span>
										)}
										{social.showText && <span class="social-text">{social.platform}</span>}
									</a>
								</li>
							);
						})}
					</ul>
				</div>
			</div>
		</div>
	</div>
	<div class="footer-bottom">
		<div class="wrapper">
			<ul class="footer-legal">
				{legalLinks && Array.isArray(legalLinks) && legalLinks.map((link: any) => {
					const url = buildNavigationUrl(link);
					const target = link.linkType === 'external' && link.openInNewTab ? '_blank' : '_self';
					const rel = link.linkType === 'external' && link.openInNewTab ? 'noopener noreferrer' : '';
					return (
						<li>
							<a href={url} target={target} rel={rel}>
								{link.label}
							</a>
						</li>
					);
				})}
			</ul>
			<!-- Theme Controls -->
			<div class="footer-theme-controls">
				<button 
					id="theme-controls-toggle" 
					class="theme-controls-btn" 
					aria-label="Open theme controls"
					popovertarget="theme-controls-popover"
				>
					<span class="theme-icon">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
						</svg>
					</span>
					<span class="theme-text">Customize</span>
				</button>
				<div id="theme-controls-popover" class="theme-controls-popover" popover="manual">
					<div class="popover-header">
						<h3>Customize Appearance</h3>
						<button 
							class="popover-close" 
							aria-label="Close theme controls"
							popovertarget="theme-controls-popover"
							popovertargetaction="hide"
						>
							<span class="material-symbols-outlined">close</span>
						</button>
					</div>
					<div class="popover-content">
						<div class="theme-section">
							<label for="theme-select">Color Theme</label>
							<select id="theme-select" aria-label="Choose theme">
								<option value="default">Sophisticated</option>
								<option value="ocean">Blue-Gray</option>
								<option value="forest">Warm Stone</option>
								<option value="sunset">Charcoal</option>
								<option value="luxury">Purple-Gray</option>
								<option value="minimal">Ultra Minimal</option>
							</select>
						</div>
						
						<div class="theme-section">
							<label for="font-mode-select">Typography</label>
							<select id="font-mode-select" aria-label="Choose font mode">
								<option value="dual">Dual Font</option>
								<option value="single">Single Font</option>
								<option value="triple">Triple Font</option>
								<option value="luxury">Luxury</option>
								<option value="performance">Performance</option>
							</select>
						</div>
						
						<div class="theme-section">
							<label>Dark Mode</label>
							<button id="theme-toggle" class="theme-toggle-btn" aria-label="Toggle dark mode">
								<span class="theme-icon">
									<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
										<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
									</svg>
								</span>
								<span class="theme-text">Toggle</span>
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</footer>